<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GOGORORO AIR DODGE</title>
<style>
  * { box-sizing: border-box; }

  body {
    margin: 0;
    font-family: "Press Start 2P", monospace;
    background: #111;
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  #game-wrapper {
    position: relative;
    width: 360px;
    height: 640px;
    border: 4px solid #555;
    background: #000;
    overflow: hidden;
    image-rendering: pixelated;
  }

  /* 背景星空 */
  #starfield {
    position: absolute;
    inset: 0;
    background:
      radial-gradient(#666 1px, transparent 1px),
      radial-gradient(#444 1px, transparent 1px);
    background-position: 0 0, 20px 20px;
    background-size: 40px 40px;
    animation: starScroll 20s linear infinite;
    opacity: 0.8;
  }
  @keyframes starScroll {
    from { transform: translateY(0); }
    to   { transform: translateY(40px); }
  }

  /* 上方資訊條 */
  #ui-bar {
    position: absolute;
    top: 0;
    width: 100%;
    height: 40px;
    background: #222;
    border-bottom: 4px solid #555;
    display: flex;
    justify-content: space-between;
    padding: 0 10px;
    align-items: center;
    font-size: 10px;
    z-index: 10;
  }

  #game-area {
    position: absolute;
    top: 40px;
    width: 100%;
    height: calc(100% - 40px);
    overflow: hidden;
  }

  /* 飛機（透明處理） */
  #player {
    position: absolute;
    width: 36px;
    height: 36px;
    background: url('https://www.oksenseijp.com/wp-content/uploads/2025/12/名称未設定のデザイン.jpg')
                no-repeat center/contain;
    border-radius: 50%;
    -webkit-mask-image: radial-gradient(circle, white 60%, transparent 100%);
    mask-image: radial-gradient(circle, white 60%, transparent 100%);
    z-index: 5;
  }

  /* 飛彈 */
  .bullet {
    position: absolute;
    width: 12px;
    height: 12px;
    background: #ff2233;
    border-radius: 2px;
    box-shadow: 0 0 6px #ff3344;
  }

  /* 開始畫面 */
  #start-screen {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.88);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 20;
    text-align: center;
    padding: 20px;
  }

  /* 標題 */
  .title {
    font-size: 18px;
    margin-bottom: 20px;
    letter-spacing: 3px;
  }

  /* 說明文字 */
  .description {
    font-size: 10px;
    margin-bottom: 16px;
    line-height: 1.8;
    letter-spacing: 2px;
  }

  /* 難易度按鈕 */
  .difficulty-btn {
    width: 200px;
    margin: 8px 0;
    padding: 10px 16px;
    font-size: 10px;
    border: 2px solid #fff;
    background: #222;
    color: #fff;
    cursor: pointer;
    letter-spacing: 2px;
  }
  .difficulty-btn:active {
    background: #444;
  }

  /* 手機拖曳區 */
  #touch-controls {
    position: absolute;
    inset: 0;
    z-index: 15;
  }
</style>
</head>
<body>

<div id="game-wrapper">
  <div id="starfield"></div>

  <div id="ui-bar">
    <div id="time">TIME 50</div>
    <div id="status">READY</div>
  </div>

  <div id="game-area">
    <div id="player"></div>
    <div id="touch-controls"></div>
  </div>

  <!-- 開始畫面 -->
  <div id="start-screen">
    <div class="title">GOGORORO</div>

    <div class="description">
      飛行機は上下左右に移動可能<br>
      50秒の生存挑戦！<br>
      難易度を選んでください
    </div>

    <button class="difficulty-btn" data-level="1">EASY</button>
    <button class="difficulty-btn" data-level="2">NORMAL</button>
    <button class="difficulty-btn" data-level="3">HARD</button>
  </div>
</div>

<script>

/* ===== DOM ===== */
const player = document.getElementById("player");
const gameArea = document.getElementById("game-area");
const timeEl = document.getElementById("time");
const statusEl = document.getElementById("status");
const startScreen = document.getElementById("start-screen");
const touchControls = document.getElementById("touch-controls");

let gameRunning = false;
let timeLeft = 50;
let timerId = null;
let bullets = [];
let last = 0;
let spawnCooldown = 0;

/* 難易度設定 → 飛彈生成頻率 */
let difficulty = 1;

const spawnRates = {
  1: { min:0.6, max:1.1 },    // EASY
  2: { min:0.25, max:0.55 },  // NORMAL（變多）
  3: { min:0.08, max:0.25 }   // HARD（超級彈幕）
};

let move = { left:false, right:false, up:false, down:false };

/* 初始化飛機 */
function resetPlayer() {
  player.style.left = (gameArea.clientWidth / 2 - 18) + "px";
  player.style.top = (gameArea.clientHeight - 80) + "px";
}

/* 開始遊戲 */
function startGame(level) {
  difficulty = level;

  bullets.forEach(b => b.el.remove());
  bullets = [];
  timeLeft = 50;
  timeEl.textContent = "TIME 50";
  statusEl.textContent = "PLAY";

  resetPlayer();
  spawnCooldown = 0;

  if (timerId) clearInterval(timerId);
  timerId = setInterval(() => {
    timeLeft--;
    timeEl.textContent = "TIME " + timeLeft;
    if (timeLeft <= 0) endGame("CLEAR!");
  }, 1000);

  startScreen.style.display = "none";
  gameRunning = true;
  last = performance.now();
  requestAnimationFrame(loop);
}

/* 遊戲結束 */
function endGame(msg) {
  gameRunning = false;
  statusEl.textContent = msg;
  if (timerId) clearInterval(timerId);

  setTimeout(() => {
    statusEl.textContent = "READY";
    timeEl.textContent = "TIME 50";
    startScreen.style.display = "flex";
  }, 800);
}

/* PC 操作 */
window.addEventListener("keydown", e => {
  if (e.key === "ArrowLeft" || e.key === "a") move.left = true;
  if (e.key === "ArrowRight" || e.key === "d") move.right = true;
  if (e.key === "ArrowUp" || e.key === "w") move.up = true;
  if (e.key === "ArrowDown" || e.key === "s") move.down = true;
});
window.addEventListener("keyup", e => {
  if (e.key === "ArrowLeft" || e.key === "a") move.left = false;
  if (e.key === "ArrowRight" || e.key === "d") move.right = false;
  if (e.key === "ArrowUp" || e.key === "w") move.up = false;
  if (e.key === "ArrowDown" || e.key === "s") move.down = false;
});

/* 手機拖曳控制 */
touchControls.addEventListener("touchmove", e => {
  const r = gameArea.getBoundingClientRect();
  const t = e.touches[0];
  player.style.left = (t.clientX - r.left - 18) + "px";
  player.style.top  = (t.clientY - r.top  - 18) + "px";
}, { passive: true });

/* 生成飛彈 */
function spawnBullet() {
  const ar = gameArea.getBoundingClientRect();
  const pr = player.getBoundingClientRect();

  const side = Math.floor(Math.random() * 4);
  const el = document.createElement("div");
  el.className = "bullet";

  let x, y;
  if (side === 0) { x = Math.random() * ar.width; y = -20; }
  if (side === 1) { x = ar.width + 20; y = Math.random() * ar.height; }
  if (side === 2) { x = Math.random() * ar.width; y = ar.height + 20; }
  if (side === 3) { x = -20; y = Math.random() * ar.height; }

  const px = pr.left - ar.left + pr.width / 2;
  const py = pr.top - ar.top + pr.height / 2;

  const dx = px - x;
  const dy = py - y;
  const len = Math.sqrt(dx * dx + dy * dy) || 1;
  const speed = 110;

  const vx = dx / len * speed;
  const vy = dy / len * speed;

  el.style.left = x + "px";
  el.style.top = y + "px";

  gameArea.appendChild(el);
  bullets.push({ el, x, y, vx, vy });
}

/* 主遊戲 LOOP */
function loop(t) {
  if (!gameRunning) return;
  const dt = (t - last) / 1000;
  last = t;

  const W = gameArea.clientWidth;
  const H = gameArea.clientHeight;

  let px = parseFloat(player.style.left);
  let py = parseFloat(player.style.top);
  const speed = 180;

  if (move.left) px -= speed * dt;
  if (move.right) px += speed * dt;
  if (move.up) py -= speed * dt;
  if (move.down) py += speed * dt;

  if (px < 0) px = 0;
  if (px > W - 36) px = W - 36;
  if (py < 0) py = 0;
  if (py > H - 36) py = H - 36;

  player.style.left = px + "px";
  player.style.top = py + "px";

  /* 飛彈生成 */
  spawnCooldown -= dt;
  if (spawnCooldown <= 0) {
    spawnBullet();
    let r = spawnRates[difficulty];
    spawnCooldown = r.min + Math.random() * (r.max - r.min);
  }

  /* 飛彈移動 + 碰撞 */
  const pr = player.getBoundingClientRect();
  bullets = bullets.filter(b => {
    b.x += b.vx * dt;
    b.y += b.vy * dt;

    b.el.style.left = b.x + "px";
    b.el.style.top = b.y + "px";

    if (b.x < -40 || b.x > W + 40 || b.y < -40 || b.y > H + 40) {
      b.el.remove();
      return false;
    }

    const br = b.el.getBoundingClientRect();
    if (
      br.left < pr.right &&
      br.right > pr.left &&
      br.top < pr.bottom &&
      br.bottom > pr.top
    ) {
      b.el.remove();
      endGame("GAME OVER");
      return false;
    }

    return true;
  });

  requestAnimationFrame(loop);
}

/* 難易度按鈕 */
document.querySelectorAll(".difficulty-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const level = Number(btn.dataset.level);
    startGame(level);
  });
});

/* 初期位置 */
resetPlayer();

</script>
</body>
</html>
